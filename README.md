# SM4 and optimizations

## SM4 多线程优化

### 基于T函数的优化

在国密SM4算法中，分为明文处理和产生密钥两大部分，而在这两部分中都有一个T函数，其主要负责置换和移位。置换部分由s盒担任，因为有32比特的置换，每个s盒只能负责8比特，所以一共需要4个s盒。而对于该T函数的置换算法，s盒与s盒之间是相互独立进行的，所以我们可以对于s盒的置换创建4个线程，每个线程负责一个s盒的置换，这样同时运行可以优化其性能。

### 运用多线程同时加密多组明文

国密SM4属于密码中的分组密码，其一次只能操作128比特的明文加密，对于大于128比特的明文，需要将其分成n个128比特的组，对于每组分别加密，最后将加密好的密文拼接起来。对于每组的加密，其相互之间其实是相互独立的，我们可以基于创建多个进程，每个进程负责一组明文的加密工作，以此来提升程序性能。

## 循环展开

在sm4中不涉及到串行循环的变量，即没有依赖的变量，我们进行循环展开，提升算法性能。
